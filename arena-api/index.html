<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="assets/reset.css" rel="stylesheet">
	<link href="assets/style.css" rel="stylesheet">
	<link href="assets/favicon.png" rel="icon">
	<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
	<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>

<body>
	<h2>Click a Marker to Learn About a Legend From That Region</h2>
	<div id="legend-map"></div>

	<section id="blocks"></section>

	<script>
		const map = L.map('legend-map', {
			center: [20, 0],
			zoom: 2,
			minZoom: 2,
			maxZoom: 5,
			worldCopyJump: true,
			maxBounds: [
				[-85, -180],
				[85, 180]
			],
			maxBoundsViscosity: 1.0
		});

		L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
			attribution: '&copy; OpenStreetMap contributors'
		}).addTo(map);

		// light colors 
		// L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
		//	attribution: '&copy; OpenStreetMap contributors, &copy; CartoDB'
		// }).addTo(map);

		// dark map 
		// L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
		// 	attribution: '&copy; OpenStreetMap contributors, &copy; CartoDB'
		// }).addTo(map);




		// coords
		const coordinates = {
			"The Story of Sinuhe": [30.0444, 31.2357],
			"The Odyssey": [38.3646, 20.7205],
			"The Legend of the Peach Blossom Spring": [28.9025, 111.4766], // Taoyuan County, Hunan, China
			"The legend of Aphrodite's love relationship": [34.7756, 32.4245], // Paphos, Cyprus
			"The Legend of the White Snake": [30.2364, 120.1503], // West Lake, Hangzhou, China
			"The Story of Jingwei": [39.1, 117.2],
			"The Odyssey": [38.3646, 20.7205],
			"The Odyssey": [38.3646, 20.7205],
			// add more as needed
		};

		async function loadArenaBlocks() {
			const res = await fetch("https://api.are.na/v2/channels/legend-drbfk5aatxo/contents?per=100");
			const data = await res.json();
			const blocks = data.contents;
			const container = document.getElementById("blocks");

			// Store blocks by title
			const blockMap = {};
			blocks.forEach(block => {
				if (block.title) blockMap[block.title] = block;
			});

			// Create a marker for each known coordinate
			Object.entries(coordinates).forEach(([title, coords]) => {
				const block = blockMap[title];
				if (!block) return;

				L.marker(coords).addTo(map)
					.on('click', () => {
						container.innerHTML = '';

						const fig = document.createElement("figure");
						fig.classList.add("active");
						fig.innerHTML = `
							<h3>${block.title}</h3>
							<p>${block.content_html || block.description_html || "No content"}</p>
						`;
						container.appendChild(fig);
						fig.scrollIntoView({ behavior: 'smooth' });
					});
			});
		}

		loadArenaBlocks();
	</script>
</body>

</html>